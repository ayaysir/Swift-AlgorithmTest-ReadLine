//
//  1725.swift
//  AlgorithmTest-ReadLine
//
//  Created by ìœ¤ë²”íƒœ on 3/29/2024.
//
//  4: íˆìŠ¤í† ê·¸ë¨ https://www.acmicpc.net/problem/1725
//

import Foundation

/// íˆìŠ¤í† ê·¸ë¨ https://www.acmicpc.net/problem/1725
/// - ìŠ¤íƒ 1
func Q_1725_() {
    let n = Int(readLine()!)!
    let histogram = (0..<n).map { _ in Int(readLine()!)! }
    
    /// ì¸ë±ìŠ¤ ì €ì¥
    var stack: [Int] = []
    var maxResult: Int = .min
    
    for i in histogram.indices {
        while !stack.isEmpty, histogram[stack.last!] >= histogram[i] {
            let height = histogram[stack.popLast()!]
            let width = stack.isEmpty ? i : i - 1 - stack.last!
            maxResult = max(maxResult, width * height)
        }
        
        stack.append(i)
    }
    
    // ì°Œêº¼ê¸° ì—†ì• ê¸°
    while !stack.isEmpty {
        let height = histogram[stack.popLast()!]
        let width = stack.isEmpty ? n : n - 1 - stack.last!
        maxResult = max(maxResult, width * height)
    }
    
    print(maxResult)
}

/// íˆìŠ¤í† ê·¸ë¨ https://www.acmicpc.net/problem/1725
/// - ìŠ¤íƒ 2 (ë§ˆì§€ë§‰ ì¶”ê°€ì‘ì—… ì•ˆí•˜ê¸°)
func Q_1725__() {
    let n = Int(readLine()!)!
    let histogram = (0..<n).map { _ in Int(readLine()!)! } + [.min]
    
    /// ì¸ë±ìŠ¤ ì €ì¥
    var stack: [Int] = [-1]
    var maxResult: Int = .min
    
    for i in 0...n {
        while stack.count > 1, histogram[stack.last!] >= histogram[i] {
            let height = histogram[stack.popLast()!]
            let width = i - 1 - stack.last!
            maxResult = max(maxResult, width * height)
        }
        
        stack.append(i)
    }
    
    print(maxResult)
}

/// íˆìŠ¤í† ê·¸ë¨ https://www.acmicpc.net/problem/1725
/// - ë¶„í•  ì •ë³µ
func Q_1725() {
    let n = Int(readLine()!)!
    let histogram = (0..<n).map { _ in Int(readLine()!)! }
    print(recursive(0, n - 1, histogram))
    
    func recursive(_ start: Int, _ end: Int, _ histogram: [Int]) -> Int {
        if end == start {
            return histogram[end]
        } else if end - start == 1 {
            if histogram[end] < histogram[start] {
                return max(2 * histogram[end], histogram[start])
            } else {
                return max(histogram[end], 2 * histogram[start])
            }
        }
        
        let mid = (start + end) / 2
        let leftArea = recursive(start, mid, histogram)
        let rightArea = recursive(mid, end, histogram)
        var midArea = histogram[mid]
        var height = histogram[mid]
        var (left, right) = (mid - 1, mid + 1)
        
        let shrinkLeft: (() -> Void) = {
            height = min(height, histogram[left])
            midArea = max(midArea, height * (right - left))
            left -= 1
        }
        
        let expandRight: (() -> Void) = {
            height = min(height, histogram[right])
            midArea = max(midArea, height * (right - left))
            right += 1
        }
        
        while start <= left, right <= end {
            histogram[left] < histogram[right] ? expandRight() : shrinkLeft()
        }
        
        while start <= left {
            shrinkLeft()
        }
        
        while right <= end {
            expandRight()
        }
        
        return max(leftArea, rightArea, midArea)
    }
}

/*
 [í’€ì´] https://st-lab.tistory.com/255
 6549(íˆìŠ¤í† ê·¸ë¨ì—ì„œ ê°€ì¥ í° ì§ì‚¬ê°í˜•) ë¬¸ì œì™€ í’€ì´ë²• ë™ì¼
 1. ë¶„í• ì •ë³µ
   => 6549ë²ˆ ë¬¸ì œë¡œ
 
 2. ìŠ¤íƒ https://loosie.tistory.com/305
 (1) indexë¥¼ ê¸°ì¤€ìœ¼ë¡œ í•´ë‹¹ íˆìŠ¤í† ê·¸ë¨ì„ íƒìƒ‰ì„ í•œë‹¤.
   - ë†’ì´ë§Œ íƒìƒ‰í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ êµ¬ê°„ì„ íƒìƒ‰í•˜ëŠ” ê²ƒì´ê¸° ë•Œë¬¸ì— íˆìŠ¤í† ê·¸ë¨ì˜ indexì™€ ë†’ì´ ë‘ ê°’ì´ ëª¨ë‘ í•„ìš”í•˜ê¸° ë•Œë¬¸ì´ë‹¤.
 (2) ië¥¼ íƒìƒ‰í•  ë•Œ í˜„ì¬ ìƒˆë¡œ ë“¤ì–´ì˜¨ ì§ì‚¬ê°í˜•ì˜ ë†’ì´(arr[i])ì™€ ì´ì „(arr[s.peek])ì— ìœ„ì¹˜í•œ ë†’ì´ì™€ ë¹„êµí•œë‹¤.
     1) arr[i] >= arr[s.peek] : ìƒˆë¡œ ë“¤ì–´ì˜¨ ì§ì‚¬ê°í˜•ì˜ ë†’ì´ê°€ ë” í´ ê²½ìš°, ì´ì „ë³´ë‹¤ ì§€ê¸ˆ ìƒˆë¡œ ë“¤ì–´ì˜¨ ì§ì‚¬ê°í˜•ì—ì„œ í° ì§ì‚¬ê°í˜•ì˜ ë„“ì´ê°€ ë‚˜ì˜¬ ìˆ˜ ìˆìœ¼ë¯€ë¡œ whileë¬¸ì„ íŒ¨ìŠ¤í•œë‹¤
     2) arr[i] < arr[s.peek] ì´ì „ì— ìœ„ì¹˜í•œ ì§ì‚¬ê°í˜• ë†’ì´ê°€ ë” í´ ê²½ìš° í° ì§ì‚¬ê°í˜•ì´ ì´ì „ì— ìœ„ì¹˜í•  í™•ë¥ ì´ ë†’ìœ¼ë¯€ë¡œ ë„“ì´ë¥¼
        êµ¬í•´ì¤€ë‹¤.   â˜› arr[i]ë³´ë‹¤ ì‘ê±°ë‚˜ ê°™ì€ ê°’ì´ ë‚˜ì˜¬ ë•Œê¹Œì§€ ë°˜ë³µ
 (3) 2ë²ˆì˜ ì—°ì‚°ì´ ëë‚¬ìœ¼ë©´(ìµœëŒ€ ë„“ì´ë¥¼ êµ¬í–ˆê±°ë‚˜ íŒ¨ìŠ¤í–ˆê±°ë‚˜) ië¥¼ stackì— ë„£ì–´ì¤€ë‹¤.
 
 [ë¡œì§]
 - Stackì— 2-1) ìƒˆë¡œ ë“¤ì–´ì˜¤ëŠ” ì§ì‚¬ê°í˜•ì˜ ë†’ì´ê°€ í˜„ì¬ ì§ì‚¬ê°í˜•ì˜ ë†’ì´ë³´ë‹¤ í´ ê²½ìš° ê°’ì„ appendí•´ì¤€ë‹¤. ê·¸ëŸ¬ë©´ ìì—°ìŠ¤ëŸ½ê²Œ ìƒˆë¡œ ë“¤ì–´ì˜¤ëŠ” ì§ì‚¬ê°í˜•ë“¤ì˜ ë†’ì´ëŠ” ì´ì „ë³´ë‹¤ ë†’ë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤.
 - ê·¸ë¦¬ê³ ë‚˜ì„œ ì´ì   2-2) ìƒˆë¡œ ë“¤ì–´ì˜¤ëŠ” ì§ì‚¬ê°í˜•ì´ í˜„ì¬ ì§ì‚¬ê°í˜•ì˜ ë†’ì´ë³´ë‹¤ ì‘ë‹¤ë©´ ì´ì „ì˜ ì§ì‚¬ê°í˜•ì´ ë” í¬ë‹¤ëŠ” ì†Œë¦¬ì´ë¯€ë¡œ ì´ì „ê¹Œì§€ ìŒ“ì•„ì™”ë˜ ë‚´ë¦¼ì°¨ìˆœ(Stackì€ í›„ì…ì„ ì¶œì´ë¯€ë¡œ)ìœ¼ë¡œ ë˜ì–´ìˆëŠ” ì§ì‚¬ê°í˜• ë†’ì´ë“¤ì„ ëª¨ë‘ ì¡°íšŒí•´ì¤€ë‹¤.
 - ë‹¨, ìƒˆë¡œ ë“¤ì–´ì˜¤ëŠ” ì§ì‚¬ê°í˜•ì˜ ë†’ì´ë³´ë‹¤ í° ê²½ìš°ê¹Œì§€ë§Œ ì¡°íšŒí•´ì¤€ë‹¤. ì´ìœ ëŠ” ë†’ì´ê°€ ê°™ê±°ë‚˜ ë‚®ìœ¼ë©´ ìƒˆë¡œ ë“¤ì–´ì˜¤ëŠ” ì§ì‚¬ê°í˜•ê³¼ ê°™ì´ ë„“ì´ë¥¼ êµ¬í•  ìˆ˜ ìˆëŠ” ì§ì‚¬ê°í˜•ì´ê¸° ë•Œë¬¸ì´ë‹¤.
 
 [ì‹œë®¬ë ˆì´ì…˜]
 arr : [ 2 1 4 5 1 3 3 ]
 
 (i = 2)
 â¬œï¸â¬‡ï¸â¬œï¸ğŸŸ¨â¬œï¸â¬œï¸â¬œï¸   ìƒˆë¡œ ë“¤ì–´ì˜¤ëŠ” ì§ì‚¬ê°í˜•(histogram[i])ì´ í˜„ì¬ ì§ì‚¬ê°í˜•ì˜ ë†’ì´(stack.peek)ë³´ë‹¤ ì‘ë‹¤ë©´ ê³„ì‚°ì„ í•´ì¤€ë‹¤.
 â¬œï¸â¬œï¸ğŸŸ¨ğŸŸ¨â¬œï¸â¬œï¸â¬œï¸   ì´ì „ ì§ì‚¬ê°í˜•ì˜ ë†’ì´ë¥¼ ê³„ì‚°í•´ì¤€ë‹¤. ì•ìœ¼ë¡œ ê³„ì‚°í•  ì´ìœ ê°€ ì—†ëŠ” ì§ì‚¬ê°í˜•ì´ì´ë¯€ë¡œ ê³„ì‚°í•´ì£¼ê³  stackì—ì„œ ì œê±°í•œë‹¤.
 â¬œï¸â¬œï¸ğŸŸ¨ğŸŸ¨â¬œï¸ğŸŸ¨ğŸŸ¨   stack.pop
 ğŸŸ¥â¬œï¸ğŸŸ¨ğŸŸ¨â¬œï¸ğŸŸ¨ğŸŸ¨   ë„“ì´ = arr[1] * 1(=>2-1-(-1)) = 2
 ğŸŸ¥ğŸŸ©ğŸŸ¨ğŸŸ¨ğŸŸ¨ğŸŸ¨ğŸŸ¨
 1ï¸âƒ£2ï¸âƒ£3ï¸âƒ£4ï¸âƒ£5ï¸âƒ£6ï¸âƒ£7ï¸âƒ£
 
 (i = 5)
 â¬œï¸â¬œï¸â¬œï¸ğŸŸ¥â¬‡ï¸â¬œï¸â¬œï¸
 â¬œï¸â¬œï¸ğŸŸ¨ğŸŸ¥â¬œï¸â¬œï¸â¬œï¸
 â¬œï¸â¬œï¸ğŸŸ¨ğŸŸ¥â¬œï¸ğŸŸ¨ğŸŸ¨   arr[2] == arr[5] ë¡œ ë†’ì´ê°€ ë˜‘ê°™ìœ¼ë¯€ë¡œ 3ë²ˆê¹Œì§€ë§Œ ê³„ì‚°í•˜ê³  whileë¬¸ ì¢…ë£Œ
 ğŸŸ¨â¬œï¸ğŸŸ¨ğŸŸ¥â¬œï¸ğŸŸ¨ğŸŸ¨   stack.pop => 4ë²ˆ ì§ì‚¬ê°í˜•
 ğŸŸ¨ğŸŸ¨ğŸŸ¨ğŸŸ¥ğŸŸ©ğŸŸ¨ğŸŸ¨   ë„“ì´1 = arr[4] * 1(=>5-1-3) = 5
 1ï¸âƒ£2ï¸âƒ£3ï¸âƒ£4ï¸âƒ£5ï¸âƒ£6ï¸âƒ£7ï¸âƒ£
 
 â¬œï¸â¬œï¸â¬œï¸ğŸŸ¨â¬‡ï¸â¬œï¸â¬œï¸
 â¬œï¸â¬œï¸ğŸŸ¥ğŸŸ¥â¬œï¸ğŸŸ¨ğŸŸ¨
 â¬œï¸â¬œï¸ğŸŸ¥ğŸŸ¥â¬œï¸ğŸŸ¨ğŸŸ¨   stack.pop => 3ë²ˆ ì§ì‚¬ê°í˜•
 ğŸŸ¨â¬œï¸ğŸŸ¥ğŸŸ¥â¬œï¸ğŸŸ¨ğŸŸ¨   ë„“ì´2 = arr[3] * 2(=>5-1-2) = 8
 ğŸŸ¨ğŸŸ¨ğŸŸ¥ğŸŸ¥ğŸŸ©ğŸŸ¨ğŸŸ¨
 1ï¸âƒ£2ï¸âƒ£3ï¸âƒ£4ï¸âƒ£5ï¸âƒ£6ï¸âƒ£7ï¸âƒ£
 
 (i = 8)
 â¬œï¸â¬œï¸â¬œï¸ğŸŸ¨â¬œï¸â¬œï¸â¬œï¸â¬‡ï¸ ë§ˆì§€ë§‰ê¹Œì§€ ì¡°íšŒê°€ ì™„ë£Œë˜ì—ˆë‹¤ë©´ ì—¬íƒœê¹Œì§€ stackì— ë‚¨ì•„ìˆëŠ” ê³„ì‚°í•˜ì§€ ëª»í•œ ì§ì‚¬ê°í˜•ë“¤ì„ ëª¨ì¡°ë¦¬ ê³„ì‚°í•´ì¤€ë‹¤.
 â¬œï¸â¬œï¸ğŸŸ¨ğŸŸ¨â¬œï¸ğŸŸ¨ğŸŸ¥   stack.pop => 7ë²ˆ ì§ì‚¬ê°í˜•
 â¬œï¸â¬œï¸ğŸŸ¨ğŸŸ¨â¬œï¸ğŸŸ¨ğŸŸ¥   ë„“ì´1 = arr[7] * 1(=>8-1-6) = 3
 ğŸŸ¨â¬œï¸ğŸŸ¨ğŸŸ¨â¬œï¸ğŸŸ¨ğŸŸ¥
 ğŸŸ¨ğŸŸ¨ğŸŸ¨ğŸŸ¨ğŸŸ¨ğŸŸ¨ğŸŸ¥ğŸŸ©
 1ï¸âƒ£2ï¸âƒ£3ï¸âƒ£4ï¸âƒ£5ï¸âƒ£6ï¸âƒ£7ï¸âƒ£
 
 â¬œï¸â¬œï¸â¬œï¸ğŸŸ¨â¬œï¸â¬œï¸â¬œï¸â¬‡ï¸
 â¬œï¸â¬œï¸ğŸŸ¨ğŸŸ¨â¬œï¸ğŸŸ¥ğŸŸ¥
 â¬œï¸â¬œï¸ğŸŸ¨ğŸŸ¨â¬œï¸ğŸŸ¥ğŸŸ¥   stack.pop => 6ë²ˆ ì§ì‚¬ê°í˜•
 ğŸŸ¨â¬œï¸ğŸŸ¨ğŸŸ¨â¬œï¸ğŸŸ¥ğŸŸ¥   ë„“ì´2 = arr[6] * 2(=>8-1-5) = 6
 ğŸŸ¨ğŸŸ¨ğŸŸ¨ğŸŸ¨ğŸŸ¨ğŸŸ¥ğŸŸ¥ğŸŸ©
 1ï¸âƒ£2ï¸âƒ£3ï¸âƒ£4ï¸âƒ£5ï¸âƒ£6ï¸âƒ£7ï¸âƒ£
 
 â¬œï¸â¬œï¸â¬œï¸ğŸŸ¨â¬œï¸â¬œï¸â¬œï¸â¬‡ï¸
 â¬œï¸â¬œï¸ğŸŸ¨ğŸŸ¨â¬œï¸ğŸŸ¨ğŸŸ¨
 â¬œï¸â¬œï¸ğŸŸ¨ğŸŸ¨â¬œï¸ğŸŸ¨ğŸŸ¨   stack.pop => 5ë²ˆ ì§ì‚¬ê°í˜•
 ğŸŸ¨â¬œï¸ğŸŸ¨ğŸŸ¨â¬œï¸ğŸŸ¨ğŸŸ¨   ë„“ì´3 = arr[5] * 5(=>8-1-2) = 5
 ğŸŸ¨ğŸŸ¨ğŸŸ¥ğŸŸ¥ğŸŸ¥ğŸŸ¥ğŸŸ¥ğŸŸ©
 1ï¸âƒ£2ï¸âƒ£3ï¸âƒ£4ï¸âƒ£5ï¸âƒ£6ï¸âƒ£7ï¸âƒ£
 
 â¬œï¸â¬œï¸â¬œï¸ğŸŸ¨â¬œï¸â¬œï¸â¬œï¸â¬‡ï¸
 â¬œï¸â¬œï¸ğŸŸ¨ğŸŸ¨â¬œï¸ğŸŸ¨ğŸŸ¨   stack.pop => 2ë²ˆ ì§ì‚¬ê°í˜•
 â¬œï¸â¬œï¸ğŸŸ¨ğŸŸ¨â¬œï¸ğŸŸ¨ğŸŸ¨   arr[2] * 7(8-1-0) = 5
 ğŸŸ¨â¬œï¸ğŸŸ¨ğŸŸ¨â¬œï¸ğŸŸ¨ğŸŸ¨
 ğŸŸ¥ğŸŸ¥ğŸŸ¥ğŸŸ¥ğŸŸ¥ğŸŸ¥ğŸŸ¥ğŸŸ©
 1ï¸âƒ£2ï¸âƒ£3ï¸âƒ£4ï¸âƒ£5ï¸âƒ£6ï¸âƒ£7ï¸âƒ£
 */
