# 백준 20176 - Needle
- https://www.acmicpc.net/problem/20176

### ✅ 문제 요약 (한국어)

북왕국에 사는 암살자 "바늘"은 남왕국으로 도망가야 합니다.
북왕국과 남왕국 사이에는 총 **3개의 가로 장벽**이 있습니다.
각 장벽에는 **여러 개의 작은 구멍**이 뚫려 있고, 이 구멍들을 통해서만 바늘이 통과할 수 있습니다.

---

### ⚙️ 조건

* 바늘은 **길고 얇은 직선 형태**이며, **세 장벽을 한 번에 꿰뚫어야** 남쪽으로 탈출할 수 있습니다.
* 즉, 바늘이 북에서 남으로 가려면,

  * **세 장벽 각각에서 구멍 하나씩을 선택**해야 하고,
  * 그 **세 개의 구멍이 하나의 직선 위에 있어야** 합니다.
* 바늘은 휘지 않으며, 벽의 구멍이 아닌 다른 부분은 통과할 수 없습니다.

![그림](https://upload.acmicpc.net/ba6c16d8-ae84-4b90-91cc-b3a7ecdbc411/-/preview/)

---

### 🎯 목표

**세 장벽에서 각각 하나씩 구멍을 선택했을 때**,
그 세 점이 **한 직선 위에 있는 조합**의 수를 출력하세요.

---

### 📥 입력

총 6줄:

1. 첫 번째 줄: 윗 장벽의 구멍 수 `nu` (1 ≤ nu ≤ 50,000)
2. 두 번째 줄: `nu`개의 x좌표
3. 세 번째 줄: 중간 장벽의 구멍 수 `nm`
4. 네 번째 줄: `nm`개의 x좌표
5. 다섯 번째 줄: 아랫 장벽의 구멍 수 `nl`
6. 여섯 번째 줄: `nl`개의 x좌표

모든 좌표는 정수이며, 구멍들은 각 장벽마다 x좌표가 모두 다름.
좌표의 범위는 `−30,000`부터 `30,000` 사이.

---

### 📤 출력

* 세 개의 장벽에서 각각 하나씩 구멍을 골라서 **직선을 만들 수 있는 조합의 수**를 출력

---

### 🔎 힌트

* 각 장벽은 y값이 정해져 있음: 윗벽은 y=2, 중간은 y=1, 아랫벽은 y=0
* 세 점이 (x1, 2), (x2, 1), (x3, 0) 형태일 때 이 세 점이 직선 위에 있는지 확인
* 즉, 중간 점이 세 점의 직선 위에 있는 경우를 찾는 것
* 수학적으로는: **x1 + x3 = 2 × x2** 조건을 만족해야 세 점이 일직선

---

# $x_1 + x_3 = 2 \times x_2$ 인 이유

**$x_1 + x_3 = 2 \times x_2$** 를 만족해야 세 점 $(x_1, 2), (x_2, 1), (x_3, 0)$이 일직선 위에 있는것

---

## ✅ 문제 구조 요약

세 점은 다음과 같습니다:

* 윗벽: $(x_1, 2)$
* 중간벽: $(x_2, 1)$
* 아랫벽: $(x_3, 0)$

---

## 🎯 목표

이 세 점이 **한 직선 위에 있다**는 건:

> 세 점이 순서대로 같은 직선 상에 나란히 놓여 있다는 뜻

즉, **세 점이 등간격으로 배치된 직선** 위에 있어야 합니다.

---

## 📐 수학적으로 접근

우리는 점 $(x_1, 2), (x_2, 1), (x_3, 0)$이 일직선상에 있는지를 판별하고 싶습니다.

### 🔍 2차원 공간에서 세 점이 일직선일 조건

세 점 $(x_1, y_1), (x_2, y_2), (x_3, y_3)$이 일직선 위에 있으려면:

$$
(x_2 - x_1)(y_3 - y_1) = (x_3 - x_1)(y_2 - y_1)
$$

를 만족해야 합니다. 이건 **기울기 비교 공식**이에요.

### ✅ 기울기 시각화 예시

```
y ↑
  |                ● (x₂, y₂)
  |              /
  |            /
  |          /
  |        /
  |      /
  |    /
  |  /
  |/__________________________→ x
 (x₁, y₁)
```

#### 🔍 설명

* 두 점 $(x₁, y₁)$과 $(x₂, y₂)$를 직선으로 연결했습니다.
* 이 직선의 **기울기**는:

$$
\text{기울기} = \frac{y₂ - y₁}{x₂ - x₁}
$$

즉,

* 세로(y) 증가분을 가로(x) 증가분으로 나눈 것이고,
* \*\*"x가 1만큼 증가할 때 y가 얼마나 증가하는가?"\*\*를 나타냅니다.
* 기울기가 크면 선이 가파르게 상승하고,
* 기울기가 0이면 수평선,
* 기울기가 음수이면 내려가는 선입니다.


#### 🧠 기울기의 의미 요약

| 기울기 값      | 의미            | 선의 방향 |
| ---------- | ------------- | ----- |
| $> 0$      | x 증가 → y도 증가  | ↗ 상승선 |
| $< 0$      | x 증가 → y는 감소  | ↘ 하강선 |
| $= 0$      | y 변화 없음       | → 수평선 |
| ∞ 또는 정의 불가 | x 변화 없음 (세로선) | ↑ 수직선 |


---

## 🔢 대입해 보자

$$
(x_2 - x_1)(0 - 2) = (x_3 - x_1)(1 - 2)
$$

$$
(x_2 - x_1)(-2) = (x_3 - x_1)(-1)
$$

양변에 음수를 없애면:

$$
2(x_2 - x_1) = x_3 - x_1
$$

전개:

$$
2x_2 - 2x_1 = x_3 - x_1
$$

$$
2x_2 = x_3 + x_1
$$

따라서

$$
x_1 + x_3 = 2x_2
$$

---

## ✅ 해석

* 이 조건은 **중간 점의 x좌표가 윗점과 아랫점의 x좌표 평균과 같아야 한다**는 뜻입니다.
* 다시 말해, **(x₁, x₂, x₃)가 등차수열**이어야 세 점이 일직선에 있음

---

## 📌 결론

| 조건                 | 의미                              |
| ------------------ | ------------------------------- |
| $x_1 + x_3 = 2x_2$ | 세 점이 한 직선 위에 있음                 |
| 해석                 | 중간 구멍의 x좌표가 위쪽과 아래쪽 구멍의 x좌표의 평균 |
| 적용 이유              | 직선은 모든 점이 일정한 기울기를 가져야 하기 때문    |

---

이 조건을 바탕으로 FFT 기반의 컨볼루션에서

* **x₁ + x₃ = 2x₂** 를 만족하는 조합을 효율적으로 계산할 수 있습니다.

## 시각화 예시

아래는 **세 점이 일직선 위에 있는지 여부**를 플레인 텍스트 그래프로 시각화한 예시입니다.
이 그래프는 세 점 $(x₁, y₁)$, $(x₂, y₂)$, $(x₃, y₃)$가 **일직선에 있는 경우**와 **아닌 경우**를 비교해서 보여줍니다.

---

### ✅ ① 세 점이 일직선 위에 있는 경우 (기울기 일정)

```
y ↑
  |                 ● (x₁, 2)
  |              /
  |           ● (x₂, 1)
  |        /
  |     ● (x₃, 0)
  |__________________________→ x
```

#### 🔍 설명

* 세 점이 같은 직선 위에 나란히 있음
* 기울기(점 간 경사도)가 일정 → 일직선

---

## ❌ ② 세 점이 일직선에 없는 경우 (기울기 불일치)

```
y ↑
  |                 ● (x₁, 2)
  |              /
  |           ● (x₂, 1)
  |              \
  |               ● (x₃, 0)
  |__________________________→ x
```

#### 🔍 설명

* 중간 점이 선에서 벗어나 있음
* 기울기(선의 경사도)가 불일치 → 일직선 아님

---

### 🎯 핵심 판단 기준

* 세 점이 일직선에 있다 → **기울기 A→B == 기울기 B→C**
* 또는 수학적으로:

  $$
  (x₂ - x₁)(y₃ - y₁) = (x₃ - x₁)(y₂ - y₁)
  $$

---

# 문제 해결 방법

단순한 브루트포스 또는 해시 기반 접근이 아니라, **수학적 구조를 변환해 컨볼루션으로 계산할 수 있도록 문제를 바꾸는 게 핵심**입니다.

---

## ✅ 핵심 수학 구조

우리는 세 개의 수열(윗벽, 중간벽, 아랫벽)에서 x좌표를 하나씩 골라
세 점 $(x_1, 2)$, $(x_2, 1)$, $(x_3, 0)$가 **한 직선 위에 있는 조합의 수**를 세고 싶습니다.

---

## 🔑 중요한 수학 조건

세 점이 일직선에 있다는 것은 중간 점이 정확히 위/아래 점을 이은 직선 위에 있다는 뜻이므로,

$$
x_1 + x_3 = 2x_2
$$

이라는 조건이 성립해야 합니다. 이 수식이 이 문제 풀이의 열쇠입니다.

---

## 🎯 FFT 기반 풀이 접근 힌트

이제부터 FFT로 풀기 위한 **전략적 흐름**을 설명합니다:

---

### 1. **윗벽, 아랫벽 구멍 x좌표를 기반으로 수열 A, B를 만든다**

* 수열 A: 윗벽 구멍의 x좌표를 정수 배열로 만들고, 그 위치에 1을 표시 (1D frequency array)
* 수열 B: 아랫벽 구멍의 x좌표를 정수 배열로 만들고, 그 위치에 1을 표시

단, 좌표 범위가 `[-30000, 30000]`이므로 배열의 인덱스를 `x + 30000`으로 **shift**해야 함
→ A와 B의 길이는 **최소 60001 이상**, 실제 컨볼루션을 위해서는 2의 거듭제곱으로 패딩 필요 (ex. 131072)

---

### 2. **수열 A와 B를 컨볼루션한다**

* A \* B의 결과 $C[k]$는
  윗벽 구멍 x좌표 $x_1$, 아랫벽 구멍 x좌표 $x_3$의 합이 $k - \text{bias}$인 쌍의 개수를 의미

즉, `x_1 + x_3 == s`인 모든 쌍의 개수를 계산한 것이 됨

---

### 3. **중간 벽의 x좌표를 이용해 결과 집계**

* 우리는 **x\_1 + x\_3 = 2x\_2** 조건을 만족해야 하므로,
  `s = 2 * x2`일 때의 컨볼루션 결과 C\[s]가 정답에 더해져야 함

* 중간 벽의 각 x좌표 $x_2$에 대해:

  * `sum = 2 * (x_2 + 30000)` ← 인덱스를 맞춰줘야 함
  * `정답 += C[sum]`

---

## ✅ 요약

| 단계                                               | 설명 |
| ------------------------------------------------ | -- |
| ① 윗벽, 아랫벽 구멍을 frequency 배열 A, B로 만듦              |    |
| ② A와 B를 FFT로 컨볼루션하여 각 x₁ + x₃ 조합의 빈도 계산          |    |
| ③ 중간 벽의 x₂에 대해 `x₁ + x₃ = 2x₂` 만족하는 `C[2x₂]`를 누적 |    |

---

## 🚨 주의할 점

* 좌표 범위 때문에 반드시 **좌표 보정 (bias: +30000)** 해야 함
* FFT 연산은 **2의 거듭제곱 길이로 패딩**
* 실수 오차 방지를 위한 `round()` 처리 필요
* 입력이 최대 50,000개 × 3 → **시간 복잡도 O(N log N)** 방식만 가능

---
